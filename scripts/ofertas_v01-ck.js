function avoidCache(){var e=Math.floor(Math.random()*500);return e}function putDefault(){$("#pic").remove();img="<img  src = 'imgs/imageDefault.jpg' id='pic' width='258px' />";$("#urlimg").append(img)}function updateimg(e){blobkey=e;$("#BlobKey").attr("value",blobkey);if(e){$("#pic").remove();var t="id="+e+"&Avc="+avoidCache();img="<img  src = '/ofimg?"+t+"' id='pic' width='256px' />";$("#urlimg").append(img)}else putDefault()}function fillpcve(e,t){$.get("/r/wordsxo",{id:""+e+""}).success(function(e){typeof e!="object"&&(e=JSON.parse(e));$.isArray(e)&&$.each(e,function(e,t){var n='<a href="#null" class="wordselected" id="pcve_'+t.token+'" value="'+t.id+'">'+t.token+"</a>";$("#unpickpcve").append(n)})}).error(function(){alert("Hay problemas de conexión, espere un momento y recargue la página")}).complete(function(){});$.get("/r/wordsxe",{id:""+t+""}).success(function(e){typeof e!="object"&&(e=JSON.parse(e));$.isArray(e)&&$.each(e,function(e,t){if($("#pcve_"+t.token).length==0){var n='<a href="#null" class="sugestWord pcve" id="pcve_'+t.token+'" value="0">'+t.token+"</a>";$("#pickpcve").append(n)}})}).error(function(){alert("Hay problemas de conexión, espere un momento y recargue la página")}).complete(function(){})}function clearpcve(){$("#unpickpcve").empty();$("#pickpcve").empty()}function fillsucursales(e,t){$.get("/r/ofsuc",{idoft:""+e+"",idemp:""+t+""}).success(function(e){typeof e!="object"&&(e=JSON.parse(e));$.each(e,function(e,t){var n='<div class="gridsubRow bg-Gry2"><label class="col-5 marg-L10pix">'+t.sucursal+'</label><input name="'+t.idsuc+'" type="checkbox" class="last marg-U5pix marg-R10pix" id="'+t.idsuc+'"/></div>';$("#listasuc").append(n);t.idoft!=""?$("#"+t.idsuc).attr("checked",!0):$("#"+t.idsuc).attr("checked",!1)})}).error(function(){alert("Hay problemas de conexión, espere un momento y recargue la página")}).complete(function(){});(function(e){e.fn.goTo=function(){e("html, body").animate({scrollTop:e(this).offset().top+"px"},"fast");return this}})(jQuery)}function activateCancel(){$("#cancelbtn").addClass("show")}function deactivateCancel(){$("#cancelbtn").removeClass("show")}$(document).ready(function(){var e="dkyqiijvlczpqjygavtt",t,n,r;$.get("/r/wso/get",{IdOft:""+e+""},function(i){console.log(i);typeof i!="object"&&(i=JSON.parse(i));if(i.status=="ok"){n=i.IdEmp;t=i.BlobKey;var s=new Date(Date.parse(i.FechaPub));r=i.UploadUrl;$("#enviar").attr("action",r);$("#uploadimg_id").attr("value",e);$("#oferta").val(i.Oferta);$("#descripcion").val(i.Descripcion);$("#date1").val(s.getUTCDate()+" Nov");$("#url").val(i.Url);$(i.categorias).each(function(){$("#categoria").append($("<option>").attr("value",this.idcat).attr("selected",this.selected).text(this.categoria))})}if(e=="none"){putDefault();$("#imgform").hide();$("#modbtn").hide();$("#newbtn").show();$("#statuspub").attr("checked",!0)}else{fillpcve(e,n);fillsucursales(e,n);$("#imgform").show();$("#modbtn").show();$("#newbtn").hide()}t!="none"?updateimg(t):putDefault();$("#loader").hide();$("#urlreq").hide();$("#placereq").hide();$("#tituloreq").hide();$("#enlinea").live("change",function(){$("#enlinea").attr("checked")?$("#muestraurl").show():$("#muestraurl").hide()});$("#enlinea").attr("checked")?$("#muestraurl").show():$("#muestraurl").hide();$("#url").blur(function(){$("#enlinea").attr("checked")&&$("#url").val()==""?$("#urlreq").show():$("#urlreq").hide()})},"json");$("#oferta").blur(function(){var e=$("#oferta").val().toLowerCase(),t=e.split(" "),n=0;for(var r in t){console.log(t[r]);t[r].replace(/^\s+|\s+$/g,"").indexOf("nueva")!=-1&&n++;t[r].replace(/^\s+|\s+$/g,"").indexOf("oferta")!=-1&&n++;console.log(n)}if(e==""||n>1){$("#tituloreq").show();console.log("nok");$("#tituloreq").goTo()}else $("#tituloreq").hide()});$("#enviardata").submit(function(){$("#IdOft").attr("value",e);console.log($("#IdOft").attr("value"));$("#IdEmp").attr("value",n);console.log($("#IdEmp").attr("value"));$("#BlobKey").attr("value",t);var r=$("#listasuc").find("input"),i=$("#unpickpcve").find("a"),s="",o="";r.each(function(){if($(this).is(":checked")&&$(this).attr("id")!="todassuc"){s+=o+$(this).attr("id");o=" "}});$("#schain").val(s);var s="",o="";i.each(function(){s+=o+$(this).text();o=" "});$("#pchain").val(s);var u=!1,r=$("#listasuc").find("input");$("#enlinea").is(":checked")?u=!0:r.each(function(){$(this).is(":checked")&&(u=!0)});if(!u){$("#placereq").show();return!1}if($("#enlinea").attr("checked")&&$("#url").val()==""){$("#urlreq").show();return!1}$("#placereq").hide();$("#urlreq").hide();var a=$("#oferta").val().toLowerCase(),f=a.split(" "),l=0;for(var c in f){f[c].replace(/^\s+|\s+$/g,"").indexOf("nueva")!=-1&&l++;f[c].replace(/^\s+|\s+$/g,"").indexOf("oferta")!=-1&&l++}if(a==""||l>1){$("#tituloreq").show();console.log("nok");$("#tituloreq").goTo();return!1}$("#tituloreq").hide();return!0});$("#enviar").validationEngine({promptPosition:"topRight",scroll:!1});$("#enviardata").validationEngine({promptPosition:"topRight",scroll:!1});var i=$("#pic"),s=400,o=$(".bar"),u=$(".percent"),a=$("#status"),f;$("#enviar").ajaxForm({dataType:"json",beforeSend:function(){a.empty();var e="0%";o.width(e);u.html(e)},uploadProgress:function(e,t,n,r){var i=r+"%";o.width(i);u.html(i)},success:function(e){console.log(e);var t="";switch(e.status){case"invalidParseUpload":t="<p>Intente nuevamente, su imagen no puede ser integrada.</p>";case"uploadSessionError":t="<p>Favor de refrescar la página para continuar.</p>";case"invalidId":t="<p>La oferta no existe.</p>";case"invalidIdOft":t="<p>La oferta no existe.</p>";case"invalidFileSize0":t="<p>Archvo en cero</p>";case"invalidUploadWriteErr":t="<p>Error al actualizar la oferta</p>";case"ok":t="<p>La imagen se integró exitosamente</p>";var n;e.UploadUrl.substr(0,5)!="https"?n==e.UploadUrl.replace("http","https"):n=e.UploadUrl;$("#enviar").attr("action",n);setTimeout(function(){updateimg(e.BlobKey)},1e3);break;default:t="<p>Intente nuevamente con una imagen de menor peso, su imagen no puede ser integrada.</p>"}a.html(t)},error:function(){a.html("<p>Intente nuevamente con una imagen de menor peso, su imagen no puede ser integrada.</p>")}});$("#pic").error(function(){putDefault()});$("textarea[maxlength]").live("keyup blur",function(){var e=$(this).attr("maxlength"),t=$(this).val();t.length>e&&$(this).val(t.slice(0,e))});$("oferta").live("keyup blur",function(){var e=$(this).attr("maxlength"),t=$(this).val();t.length>e&&$(this).val(t.slice(0,e))});$("#pcvepicker").on("click","a",function(t){var r=$(this);$(this).attr("value")=="0"?$("#unpickpcve a").length<5?$.get("/r/addword",{token:""+r.text()+"",id:""+e+""},function(e){typeof e!="object"&&(e=JSON.parse(e));if(e.status=="ok"){r.attr("class","wordselected");r.attr("value",e.id);$("#unpickpcve").append(r)}else e.status!="notFound"&&(e.status=="invalidText"?alert("La palabra clave contiene carácteres no permitidos"):e.status=="writeErr"&&alert("Hay problemas de conexión. Intente agregar de nuevo la palabra clave"))},"json"):alert("Máximo 5 palabras"):$(this).attr("value")=="E"?$.get("/r/rmword",{id:""+n+"",token:""+r.text()+""},function(e){typeof e!="object"&&(e=JSON.parse(e));e.status=="ok"&&r.remove()},"json"):$.get("/r/delword",{id:""+r.attr("value")+"",token:""+r.text()+""},function(e){typeof e!="object"&&(e=JSON.parse(e));if(e.status=="ok"){r.attr("class","sugestWord");r.attr("value","0");$("#pickpcve").append(r)}else alert("Hay problemas de conexión. Intente eliminar de nuevo la palabra clave")},"json")});$("#nuevapcve").click(function(t){var r=$("#tokenpcve");if(r.val().length>=3){$("#unpickpcve a").length<5?$.get("/r/addword",{token:""+r.val()+"",id:""+e+""},function(t){typeof t!="object"&&(t=JSON.parse(t));if(t.status=="ok"){clearpcve();fillpcve(e,n)}else alert("Hay problemas de conexión. Intente agregar de nuevo la palabra clave o recargue la página")},"json"):alert("Máximo 5 palabras");$("#tokenpcve").val("")}$("#tokenpcve").trigger("blur")});$("#todassuc").click(function(e){var t=$("#listasuc").find("input");t.each(function(e,t){$("#todassuc").is(":checked")?$(this).is("id")!="todassuc"&&$(this).attr("checked",!0):$(this).is("id")!="todassuc"&&$(this).attr("checked",!1)})});var l=!1;$("#elimilink").click(function(e){if(!l){$(".sugestWord").addClass("eliminateWord");$(".sugestWord").attr("value","E");l=!0;$("#elimilink").addClass("button");$("#elimilink").addClass("red");$("#elimilink").addClass("small");$("#unpickpcve").addClass("hide");$("#tokenpcve").addClass("hide");$("#btnaddWords").addClass("hide");$("#elimilink").html("<span>Terminar </span>");$("#titleWord").html("Clic aquí para remover palabras que no necesites")}else{$(".sugestWord").attr("value","0");$(".eliminateWord").removeClass("eliminateWord");$("#elimilink").removeClass("button");$("#elimilink").removeClass("red");$("#elimilink").removeClass("small");$("#unpickpcve").removeClass("hide");$("#tokenpcve").removeClass("hide");$("#btnaddWords").removeClass("hide");$("#elimilink").html("Eliminar palabras capturadas");$("#titleWord").html("Otras palabras que has capturado");l=!1}return!1})});