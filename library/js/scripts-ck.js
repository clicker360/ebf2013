/**
 * Métodos autoejecutables. Estos métodos se ejecutan al cargar la página.
 * @returns {function} execute - Retorna la ejecución de los métodos registrados en este método.
 */(function(){var e=function(){registros.registrarse()},t=function(){empresas.initEmpresas()},n=function(){micrositio.extrasformulario()},r=function(){$(document).on("click","a.editar-empresa",function(e){e.preventDefault();var t=$(this).attr("rel");empresas.empresaformdesdejson(t);micrositio.cargarmicrositio(t)})},i=function(){$(document).on("click","a.nuevaempresa",function(e){e.preventDefault();empresas.empresaformdesdejson()})},s=function(){empresas.empresa_envia()},o=function(){$(document).on("click","a.ver-sucursales",function(e){e.preventDefault();var t=$(this).attr("rel");sucursales.initSucursales(t);$("#añadir-suc-empresa").html('<a class="nuevasucursal span12 btn btn-success" rel="'+t+'" ><i class="icon-plus"></i> Añadir nueva sucursal</a>')})},u=function(){$(document).on("click","a.editar-sucursal",function(e){e.preventDefault();var t=$(this).attr("rel");sucursales.sucursalformdesdejsonModifica(t)})},a=function(){$(document).on("click","a.nuevasucursal",function(e){e.preventDefault();var t=$(this).attr("rel");sucursales.sucursalformdesdejsonNueva(t)})},f=function(){sucursales.sucursal_envia()},l=function(){$("#submitImage").on("click",function(e){$("#imgfile").val($("#infile").val());micrositio.enviarimagen()})},c=function(){micrositio.enviarDatos()},h=function(){$(document).on("click","a.ver-ofertas",function(e){e.preventDefault();var t=$(this).attr("rel");ofertas.initOfertas(t);$("#añadir-suc-empresa").html('<a class="nuevasucursal span12 btn btn-success" rel="'+t+'" ><i class="icon-plus"></i> Añadir nueva sucursal</a>')})},p=function(){$(document).ready(function(){e();t();o();r();u();i();a();s();f();l();c()})};return p()})();var Ajax=function(){var e=function(){$("#preloader").fadeIn("fast")},t=function(e){$("#preloader").fadeOut("fast");if(typeof e!="undefined"){$(".activo").removeClass("activo").addClass("inactivo");e.addClass("activo").removeClass("inactivo")}},n=function(t,n){e();$.ajax({url:t,dataType:"json",success:function(e){typeof n=="function"&&n.call(n,e)}})},r=function(t,n,r){e();$.ajax({type:"POST",url:t,dataType:"json",data:n,success:function(e){typeof r=="function"&&r.call(r,e)}})};return{hidePreload:t,get:n,post:r}}(),catalogos=function(){}(),empresas=function(){var e=function(){var e="",t=$("#empresaTemplateDash").html(),n=_.template(t),r="",i=$("#empresaTemplate").html(),s=_.template(i);Ajax.get("/r/wse/gets",function(t){e=n({empresasArrayDash:t});r=s({empresasArray:t});$("#empresasBlockDash").html(e);$("#empresasBlock").html(r);Ajax.hidePreload()})},t=function(e){if(e){$("#btn-empresa").html("Modificar");Ajax.get("/r/wse/get?IdEmp="+e,function(e){$("#empresa-form").formParams(e,!0);llenamuniEmpresa(e.DirEnt,e.DirMun);llenaorganismos(e.OrgEmp);Ajax.hidePreload($("#empresas-detalle"))})}else{$("#btn-empresa").html("Crear");llenamuniEmpresa("01");llenaorganismos();Ajax.hidePreload($("#empresas-detalle"))}},n=function(){$(document).on("submit","form#empresa-form",function(e){e.preventDefault();var t=$(this).serialize();$("#btn-empresa").html()=="Crear"?Ajax.post("/r/wse/put",t,function(e){if(e.status=="ok"){alert("registrado correctamente");location.href="/r/index"}}):Ajax.post("/r/wse/post",t,function(e){if(e.status=="ok"){alert("registrado correctamente");location.href="/r/index"}})})};return{initEmpresas:e,empresaformdesdejson:t,empresa_envia:n}}(),sucursales=function(){var e,t,n,r,i=function(){var r=[];r.push($("#DirMunSuc option:selected").text());r.push($("#DirEntSuc option:selected").text());r.push($("#calle").val());r.push($("#colonia").val());var i="",s="";$.each(r,function(e,t){if(t){i=i+s+t;s=", "}});i+=", MEXICO";t||(t=new google.maps.Geocoder);var o={address:i};t.geocode(o,function(t,r){if(r==google.maps.GeocoderStatus.OK){e.setCenter(t[0].geometry.location);e.setZoom(17);n||(n=new google.maps.Marker({map:e,draggable:!0}));n.setPosition(t[0].geometry.location);document.getElementById("lat").value=t[0].geometry.location.lat();document.getElementById("lng").value=t[0].geometry.location.lng()}})},s=function(){var t=17,r=$("#lat").val(),s=$("#lng").val();if(!r){r=19.434341;s=-99.141483;t=10}var o=new google.maps.LatLng(r,s),u={zoom:t,center:o,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1};e=new google.maps.Map(document.getElementById("mapas"),u);if(!n){n=new google.maps.Marker({map:e,draggable:!0});n.setPosition(o)}$("#DirEntSuc").bind("change",function(e){i()});$("#calle").bind("change",function(e){i()});$("#colonia").bind("change",function(e){i()});$("#buscar").bind("keydown keyup mousedown",function(e){i()});google.maps.event.addListener(n,"dragend",function(){var t=""+this.getPosition(),n=t.split(",");document.getElementById("lat").value=n[0].replace("(","");document.getElementById("lng").value=n[1].replace(")","");e.setCenter(this.getPosition())})},o=function(e){var t={},n="",r=$("#sucursalesTemplate").html(),i=_.template(r);Ajax.get("/r/wss/gets?IdEmp="+e,function(e){n=i({sucursalesArray:e});$("#sucursalesBlock").html(n);Ajax.hidePreload($("#sucursales-lista"))})},u=function(e){$("#btn-sucursal").html("Modificar");Ajax.get("/r/wss/get?IdSuc="+e,function(e){$("#sucursal-form").formParams(e,!0);llenamuniSucursal(e.DirEnt,e.DirMun);Ajax.hidePreload($("#sucursal-detalle"));s()})},a=function(e){$("#IdEmpSuc").val(e);$("#btn-sucursal").html("Crear");llenamuniSucursal("01");Ajax.hidePreload($("#sucursal-detalle"));s()},f=function(){$(document).on("submit","form#sucursal-form",function(e){e.preventDefault();var t=$(this).serialize();$("#btn-sucursal").html()=="Crear"?Ajax.post("/r/wss/put",t,function(e){if(e.status=="ok"){alert("registrado correctamente");location.href="/r/index"}}):Ajax.post("/r/wss/post",t,function(e){if(e.status=="ok"){alert("registrado correctamente");location.href="/r/index"}})})};return{initSucursales:o,sucursalformdesdejsonModifica:u,sucursalformdesdejsonNueva:a,sucursal_envia:f,mostrarMapa:s}}(),registros=function(){var e=function(){$("form#registroform").on("submit",function(e){e.preventDefault();var t=$(this).serialize();Ajax.post("/r/wsr/put",t,function(e){e.success&&alert("registrado correctamente")})})};return{registrarse:e}}(),micrositio=function(){var e=function(){$("#pic").remove();img="<img  src = 'imgs/imageDefault.jpg' id='pic' width='258px' />";$("#urlimg").append(img)},t=function(){var e=Math.floor(Math.random()*500);return e},n=function(n){blobkey=n;$("#BlobKey").attr("value",blobkey);if(n){$("#pic").remove();var r="id="+n+"&Avc="+t();img="<img  src = '/extraimg?"+r+"' id='pic' width='256px' />";$("#urlimg").append(img)}else e()},r=function(t){Ajax.get("/r/wsed/get?IdEmp="+t,function(r){if(r.status=="ok"){var i=r.BlobKey,s=r.UploadUrl;$("#IdEmp").attr("value",r.IdEmp);$("#enviar").attr("action",s);$("#BlobKey").attr("value",i);$("#uploadimg_id").attr("value",t);$("#empresa").html(r.Empresa);$("#descripcion").val(r.Desc);$("#facebook").val(r.Facebook);$("#twitter").val(r.Twitter);i?n(i):e()}else e()})},i=function(){var e=$(".bar"),t=$(".percent"),r=$("#status");$("#enviar").ajaxSubmit({dataType:"json",iframe:!0,beforeSend:function(){r.empty();var n="0%";e.width(n);t.html(n)},uploadProgress:function(t,n,r,i){var s=i+"%";e.width(s)},success:function(e){var t="";switch(e.status){case"invalidUpload":t="<p>Intente nuevamente, su imagen no puede ser integrada.</p>";case"uploadSessionError":t="<p>Favor de refrescar la página para continuar.</p>";case"notFound":t="<p>La oferta no existe.</p>";case"ok":t="<p>La imagen se integró exitosamente</p>";var i;i=e.UploadUrl;$("#enviar").attr("action",i);setTimeout(function(){n(e.BlobKey)},1e3);break;default:t="<p>Intente nuevamente con una imagen de menor peso, su imagen no puede ser integrada.</p>"}r.html(t)},complete:function(){e.width("100%")},error:function(){r.html("<p>Intente nuevamente con una imagen de menor peso, su imagen no puede ser integrada.</p>")}})},s=function(){$(document).on("submit","#enviardata",function(e){e.preventDefault();var t=$(this).serialize(),n=$(this).attr("action");Ajax.post(n,t,function(e){if(e.status=="ok"){alert("Micrositio registrado correctamente");location.href="/r/index"}})})},o=function(){$("#pic").error(function(){putDefault()});$("textarea[maxlength]").live("keyup blur",function(){var e=$(this).attr("maxlength"),t=$(this).val();t.length>e&&$(this).val(t.slice(0,e))});$("input[maxlength]").live("keyup blur",function(){var e=$(this).attr("maxlength"),t=$(this).val();t.length>e&&$(this).val(t.slice(0,e))})};return{cargarmicrositio:r,enviarimagen:i,extrasformulario:o,enviarDatos:s}}(),ofertas=function(){var e=function(){var e="",t=$("#empresaTemplate").html(),n=_.template(t);Ajax.get("/r/wse/gets",function(t){imprimeTemplateDash=underTemplateDash({empresasArrayDash:t});e=n({empresasArray:t});$("#empresasBlockDash").html(imprimeTemplateDash);$("#empresasBlock").html(e);Ajax.hidePreload()})},t=function(){$("#pic").remove();img="<img  src = 'imgs/imageDefault.jpg' id='pic' width='258px' />";$("#urlimg").append(img)},n=function(){var e=Math.floor(Math.random()*500);return e},r=function(e){blobkey=e;$("#BlobKey").attr("value",blobkey);if(e){$("#pic").remove();var r="id="+e+"&Avc="+n();img="<img  src = '/extraimg?"+r+"' id='pic' width='256px' />";$("#urlimg").append(img)}else t()},i=function(e){Ajax.get("/r/wsed/get?IdEmp="+e,function(n){if(n.status=="ok"){var i=n.BlobKey,s=n.UploadUrl;$("#IdEmp").attr("value",n.IdEmp);$("#enviar").attr("action",s);$("#BlobKey").attr("value",i);$("#uploadimg_id").attr("value",e);$("#empresa").html(n.Empresa);$("#descripcion").val(n.Desc);$("#facebook").val(n.Facebook);$("#twitter").val(n.Twitter);i?r(i):t()}else t()})},s=function(){var e=$(".bar"),t=$(".percent"),n=$("#status");$("#enviar").ajaxSubmit({dataType:"json",iframe:!0,beforeSend:function(){n.empty();var r="0%";e.width(r);t.html(r)},uploadProgress:function(t,n,r,i){var s=i+"%";e.width(s)},success:function(e){var t="";switch(e.status){case"invalidUpload":t="<p>Intente nuevamente, su imagen no puede ser integrada.</p>";case"uploadSessionError":t="<p>Favor de refrescar la página para continuar.</p>";case"notFound":t="<p>La oferta no existe.</p>";case"ok":t="<p>La imagen se integró exitosamente</p>";var i;i=e.UploadUrl;$("#enviar").attr("action",i);setTimeout(function(){r(e.BlobKey)},1e3);break;default:t="<p>Intente nuevamente con una imagen de menor peso, su imagen no puede ser integrada.</p>"}n.html(t)},complete:function(){e.width("100%")},error:function(){n.html("<p>Intente nuevamente con una imagen de menor peso, su imagen no puede ser integrada.</p>")}})},o=function(){$(document).on("submit","#enviardata",function(e){e.preventDefault();var t=$(this).serialize(),n=$(this).attr("action");Ajax.post(n,t,function(e){if(e.status=="ok"){alert("Micrositio registrado correctamente");location.href="/r/index"}})})},u=function(){$("#pic").error(function(){putDefault()});$("textarea[maxlength]").live("keyup blur",function(){var e=$(this).attr("maxlength"),t=$(this).val();t.length>e&&$(this).val(t.slice(0,e))});$("input[maxlength]").live("keyup blur",function(){var e=$(this).attr("maxlength"),t=$(this).val();t.length>e&&$(this).val(t.slice(0,e))})};return{initEmpresas:initEmpresas}}();